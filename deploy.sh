#!/bin/bash

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN='\033[0;32m'
BLUE='\033[0;34m'
RED='\033[0;31m'
NC='\033[0m' # No Color

echo -e "${BLUE}üöÄ –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–ø–ª–æ–π –Ω–∞ Beget...${NC}\n"

# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "package.json" ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: package.json –Ω–µ –Ω–∞–π–¥–µ–Ω${NC}"
    echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞"
    exit 1
fi

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ .env.production
if [ ! -f ".env.production" ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: .env.production –Ω–µ –Ω–∞–π–¥–µ–Ω${NC}"
    echo "–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env.production —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
    exit 1
fi

# 3. –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥ –∏–∑ Git (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
echo -e "${BLUE}üì• –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥ –∏–∑ Git...${NC}"
git pull origin main

# 4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo -e "${BLUE}üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏...${NC}"
npm install

# 5. –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç
echo -e "${BLUE}üî® –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç...${NC}"
npm run build

if [ $? -ne 0 ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –ø—Ä–æ–µ–∫—Ç–∞${NC}"
    exit 1
fi

echo -e "${GREEN}‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω!${NC}"
echo -e "${BLUE}üì¶ –†–∞–∑–º–µ—Ä bundle:${NC}"
du -sh dist/

# 6. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Beget
echo -e "\n${GREEN}‚úÖ –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é!${NC}\n"
echo -e "${BLUE}üì§ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:${NC}"
echo "1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Beget –ø–æ FTP (FileZilla, Cyberduck –∏ —Ç.–¥.)"
echo "2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É public_html –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞"
echo "3. –£–¥–∞–ª–∏—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ public_html"
echo "4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ dist/ –≤ public_html/"
echo "5. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .htaccess (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ .htaccess.example)"
echo ""
echo -e "${BLUE}üìù –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH:${NC}"
echo "ssh –≤–∞—à-–ª–æ–≥–∏–Ω@–≤–∞—à-–¥–æ–º–µ–Ω.beget.tech"
echo "cd ~/–≤–∞—à-—Ä–µ–ø–æ"
echo "rm -rf ~/–≤–∞—à-–¥–æ–º–µ–Ω.ru/public_html/*"
echo "cp -r dist/* ~/–≤–∞—à-–¥–æ–º–µ–Ω.ru/public_html/"
echo "cp .htaccess.example ~/–≤–∞—à-–¥–æ–º–µ–Ω.ru/public_html/.htaccess"
echo ""
echo -e "${GREEN}üåê –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∞–π—Ç!${NC}"
